# WinUI 验收标准（DoD + 回归）

## 1. DoD（完成定义）

满足以下全部条件才算 WinUI 等价完成：

1. Embed/Detect/DB 三页功能行为与 macOS 基线一致。
2. 检测信息卡固定 6 行、无滚动、语义色一致。
3. 删除模式双入口互斥，二次确认必须输入选中数量。
4. 顶栏状态图标可悬浮查看详情并支持点击刷新。
5. Windows 安装包可安装、运行、卸载，并支持可选清理本地数据。
6. CI 在 `windows-latest` 可完成构建、测试、打包、产物上传。

## 2. 功能回归清单

### 2.1 Embed 页

1. 空态：无输入源、无队列时按钮禁用正确。
2. 选择文件：输入源更新，队列追加。
3. 选择目录：仅扫描当前层 wav/flac。
4. 重复文件：去重并写日志。
5. 拖拽：只改队列，不改输入源。
6. 嵌入成功：队列项移除，进度推进。
7. 嵌入后：自动写入证据库（失败仅 warning）。

### 2.2 Detect 页

1. 空态：字段值全部 `-`。
2. 单文件检测：状态/标签/身份/版本显示正确。
3. clone-check：exact/likely/suspect/unavailable 显示与颜色正确。
4. 检测分数、指纹分数字段显示正确。
5. 日志选中联动：选中日志显示对应记录。
6. 取消选中：隐藏详情或回退逻辑符合现规范。
7. 清空日志：仅“已清空日志”自动消失。

### 2.3 DB 查询页

1. 默认显示映射与证据最近记录。
2. 搜索可筛映射与证据。
3. 删除标签/删除证据模式互斥。
4. 全选/全不选可用。
5. 输入数量确认后才可删除。
6. 删除后计数与列表同步刷新。

## 3. 视觉与排版验收

1. 窗口默认尺寸与最小尺寸符合 token。
2. 间距、圆角、标题条样式与 macOS 结构一致。
3. 同文案按钮靠图标区分且可访问性标签完整。
4. 字段键值不溢出，长文本有 tooltip。
5. 深浅色模式下对比度满足可读性。

## 4. 性能与稳定性门槛

1. 单次批处理 200 条日志上限不崩溃。
2. 100 文件批处理 UI 无明显卡死（主线程无 >200ms 阻塞）。
3. SQLite 查询与批量删除无死锁。
4. Native 句柄无泄漏（多次打开关闭流程）。

## 5. 打包与运维验收

1. 安装器可正常安装到用户目录。
2. 卸载时提供可选清理 `%USERPROFILE%\\.awmkit`。
3. 清理选项开启时，数据库与 bundled 缓存被删除。
4. 清理选项关闭时，用户数据保留。

## 6. CI 验收

1. Rust windows target 构建通过。
2. `cargo test --features app` 通过。
3. Inno 脚本 dry-run 编译通过。
4. 产物上传包含：
   - `awmkit.exe`
   - `awmkit.dll`
   - 安装包 `.exe`
   - 构建摘要
